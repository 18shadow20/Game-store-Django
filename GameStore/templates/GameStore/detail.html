{% extends 'GameStore/base.html' %}

{% block title %} {{ game.name }} {% endblock %}

{% block content %}
<div class="container py-4">
  <div class="row">
    <div class="col-md-5">
      <img src="{{ game.image.url }}" alt="{{ game.name }}" class="img-fluid rounded shadow-sm">
    </div>
    <div class="col-md-7">
      <h1 class="fw-bold">{{ game.name }}</h1>
      <p class="text-muted">{{ game.genre.all|join:", " }}</p>
      <p class="mt-3">{{ game.description|truncatewords:40 }}</p>

      <div class="mt-4 d-flex align-items-center justify-content-between">
        <span class="h4 text-success">{{ game.price }} BYN</span>
        {% if game.is_available %}
          <form action="{% url 'cart_add' game.id %}" method="post" class="d-inline">
              {% csrf_token %}
              <input type="hidden" name="quantity" value="1">
              <input type="hidden" name="update" value="false">
              <button type="submit" class="btn btn-outline-dark btn-sm">üõí –î–æ–±–∞–≤–∏—Ç—å</button>
          </form>
        {% else %}
          <span class="text-danger fw-semibold">–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏</span>
        {% endif %}
      </div>

      <div class="mt-4">
        <h6 class="fw-semibold">–ú–µ—Ç–∫–∏:</h6>
        <div>
          {% for tag in game.tag.all %}
            <span class="badge bg-secondary me-1">{{ tag.name }}</span>
          {% endfor %}
        </div>
      </div>
    </div>

    <div class="container mt-5">
      <h3 class="mb-4">–û—Ç–∑—ã–≤—ã</h3>

      <!-- —Ñ–æ—Ç–æ –∏–≥—Ä—ã -->
      <div class="game-gallery row row-cols-2 row-cols-md-3 g-2 mt-4">
          {% if game.game_gallery.all %}
              {% for img in game.game_gallery.all %}
                  <div class="col">
                      <img src="{{ img.image.url }}" class="img-fluid rounded shadow-sm" alt="–°–∫—Ä–∏–Ω—à–æ—Ç">
                  </div>
              {% endfor %}
          {% else %}
              <div class="col">
                  <img src="{{ game.image.url }}" class="img-fluid rounded shadow-sm" alt="{{ game.name }}">
              </div>
          {% endif %}
      </div>



      <!-- –í—ã–≤–æ–¥ –≤—Å–µ—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ -->
      {% if game.comment_set.all %}
        {% for comment in game.comment_set.all %}
          <div class="border rounded p-3 mb-3">
            <strong>{{ comment.user.username }}</strong>
            <span class="text-muted small">{{ comment.created_at|date:"d.m.Y H:i" }}</span>
            <p class="mt-2 mb-0">{{ comment.text }}</p>
          </div>
        {% endfor %}
      {% else %}
        <p class="text-muted">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –ø–æ–∫–∞ –Ω–µ—Ç.</p>
      {% endif %}

      <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è -->
      {% if user.is_authenticated %}
        <hr>
        <h5>–û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</h5>
        <form method="post" class="mt-3">
          {% csrf_token %}
          {{ form.as_p }}
          <button type="submit" class="btn btn-outline-dark">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        </form>
      {% else %}
        <p class="text-muted">–ß—Ç–æ–±—ã –æ—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤, <a href="{% url 'login_view' %}">–≤–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç</a>.</p>
      {% endif %}
    </div>

  </div>
</div>
{% endblock %}
